var Jingle=J={settings:{transitionType:"slide",transitionTime:300,transitionTimingFunc:"ease-in-out",sectionPath:"html/"},mode:800>window.innerWidth?"phone":"tablet",hasTouch:"ontouchstart"in window,hasLaunched:!1,launchCompleted:!1,isMenuOpen:!1,hasPopupOpen:!1,launch:function(t){$.extend(this.settings,t),this.Router.init(),this.Element.init(),document.addEventListener("touchmove",function(t){t.preventDefault()},!1)},anim:function(t,n){for(var i,e,a,o=arguments.length,s=2;o>s;s++){var c=arguments[s],r=$.type(c);"number"==r?i=c:"string"==r?e=c:"function"==r?a=c:null}$(t).animate(n,i||J.settings.transitionTime,e||J.settings.transitionTimingFunc,a)},showMask:function(t,n){"function"==$.type(t)&&(n=t,t=null),t=t||"Loading...",this.Toast.show("loading",t,n)},hideMask:function(){this.Toast.hide()},showToast:function(t,n){n=n||"toast",this.Toast.show(n,t)},hideToast:function(){this.Toast.hide()},alert:function(t){this.Popup.alert(t)},confirm:function(t,n,i){this.Popup.confirm(t,n,i)},popup:function(t,n,i){this.Popup.show(t,n,i)},closePopup:function(){this.Popup.close()}};Jingle.Element=function(){var t={icon:"[data-icon]",scroll:'article[data-scroll="true"]',toggle:".toggle",range:"[data-rangeinput]",progress:"[data-progress]"},n=function(n){var c=$(n||"body");0!=c.length&&($.map($(t.icon,c),i),$.map($(t.scroll,c),e),$.map($(t.toggle,c),a),$.map($(t.range,c),o),$.map($(t.progress,c),s))},i=function(t){$(t).prepend('<i class="icon '+$(t).data("icon")+'"></i>')},e=function(t){$(t).wrapInner("<div></div>"),$(t).on("show",function(){new iScroll(t)})},a=function(t){var n=$(t),i=n.attr("name");i&&n.append('<input style="display: none;" name="'+i+'" value="'+n.hasClass("active")+'"/>');var e=n.find("input");n.tap(function(){var t;n.hasClass("active")?(n.removeClass("active"),t=!1):(n.addClass("active"),t=!0),e.val(t),n.trigger("toggle")})},o=function(t){var n,i=$(t),e=$('input[type="range"]',t),a=i.data("rangeinput"),o=$('<input type="text" name="test" value="'+e.val()+'"/>');n="left"==a?o.prependTo(i):o.appendTo(i);var s=parseInt(e.attr("max"),10),c=parseInt(e.attr("min"),10);e.change(function(){n.val(e.val())}),n.on("input",function(){var t=parseInt(n.val(),10);t=t>s?s:c>t?c:t,e.val(t),n.val(t)})},s=function(t){var n=$(t),i=n.data("progress"),e=n.data("title")||"",a=$('<div class="bar"></div>');a.appendTo(n).width(i).text(e+i)};return{init:n}}(),Jingle.Page=function(t){var n=function(t){return 0==t.indexOf("#")?t.substr(1):t},i=function(i){$.ajax({url:t.settings.sectionPath+n(i)+".html",timeout:5e3,async:!1,success:function(t){$("#section-container").append(t)}})},e=function(n,i,e){$.get(t.templateFoler+i,function(t){var i=$.tmpl(t,n);e(i)})},a=function(t,n,i){return $("#"+t).length>0?(go(t),void 0):($.get(n,function(n){e(n,i,function(n){$("body").append(n),go(t)})}),void 0)};return{load:i,loadPageByTmpl:a}}(Jingle),Jingle.Router=function(){var t="a[data-target]",n=[],i=function(){$(window).on("popstate",e),$(document).on("tap","a",function(t){t.preventDefault()}),$(document).on("click","a",function(t){t.preventDefault()}),$(document).on("tap",t,a);var n=$("#section-container section.active").trigger("show").attr("id");r("#"+n)},e=function(t){if(t.state&&t.state.hash){var i=t.state.hash;i===n[1]&&s()}},a=function(t){t.preventDefault();var n=$(this),i=n.attr("data-target"),e=n.attr("href");switch(i){case"section":o(e);break;case"article":l(e,n);break;case"menu":u();break;case"back":s()}},o=function(t){if(J.isMenuOpen&&J.Menu.hide(),n[0]!==t){var i=$(n[0]);r(t),0===$(t).length&&(J.Page.load(t),J.Element.init(t)),c(i,t)}},s=function(){c(n.shift(),n[0],!0),window.history.replaceState({hash:n[0]},"",n[0])},c=function(t,n,i){J.Transition.run(t,n,i)},r=function(t){n.unshift(t),window.history.pushState({hash:t},"",t)},l=function(t,n){var i=$(t);if(!i.hasClass("active")){n.addClass("active").siblings(".active").removeClass("active");var e=i.addClass("active").siblings(".active").removeClass("active");J.anim(i,"scaleIn",300,function(){i.trigger("show"),e.trigger("hide")})}},u=function(){J.isMenuOpen?J.Menu.hide():J.Menu.show()};return{init:i,turnTo:o,back:s}}(),Jingle.Service=function(){function t(t,n,i,e){var a=!$.isFunction(n);return{url:t,data:a?n:void 0,success:a?$.isFunction(i)?i:void 0:n,dataType:a?e||i:i}}var n="JINGLE_POST_DATA",i=function(t){"post"==t.type?e(t):a(t)},e=function(t){J.offline?(c(t.url,t.data),t.success("数据已存至本地")):$.ajax(t)},a=function(t){var n=t.url+JSON.stringify(t.data);if(J.offline){var i=o(n);i?t.success(i.data,i.createdTime):t.success(i)}else{var e=option.success;option.success=function(t){s(n,t),e(t)},$.ajax(t)}},o=function(t){return $.parse(localStorage.getItem(t))},s=function(t,n){var i={data:n,createdTime:new Date};localStorage.setItem(t,JSON.stringify(i))},c=function(t,i){var e=r();e||(e={}),e[t]={data:i,createdTime:new Date},localStorage.setItem(n,JSON.stringify(e))},r=function(t){var i=$.parse(localStorage.getItem(n));return t?i[t]:i},l=function(t){if(t){var i=r();delete i[t],localStorage.setItem(n,JSON.stringify(i))}else localStorage.removeItem(n)},u=function(t,n,i){var e=r(t).data;$.ajax({url:t,data:e,type:"post",success:function(){n(t)},error:function(){i(t)}})},d=function(t,n){var i=r();for(var e in i)u(e,t,n)},p=function(){return i(t.apply(null,arguments))},f=function(){var n=t.apply(null,arguments);return n.type="POST",i(n)},g=function(){var n=t.apply(null,arguments);return n.dataType="json",i(n)};return{ajax:i,get:p,post:f,getJSON:g,getUnPostData:r,removeUnPostData:l,syncPostData:u,syncAllPostData:d}}(),Jingle.Toast=function(){var t,n,i,e={toast:'<a href="#">{value}</a>',success:'<i class="icon checkmark-circle"></i>{value}',error:'<i class="icon cancel-circle"></i>{value}',info:'<i class="icon info-2"></i>{value}',loading:'<i class="icon spinner"></i><p>{value}</p><div id="tag_close_toast" class="icon cancel-circle"></div>'},a="toast",o=function(){},s=function(){$("body").append('<div id="jingle_toast"></div><div id="jingle_toast_mask"></div>'),n=$("#jingle_toast_mask"),t=$("#jingle_toast"),l()},c=function(){"loading"==a?(t.hide(),n.hide()):"toast"==a?J.anim(t,"scaleOut",function(){t.hide()}):J.anim(t,"slideUpOut",function(){t.hide()})},r=function(s,r,l){i&&clearTimeout(i),a=s,t.attr("class",s).html(e[s].replace("{value}",r)).show(),"loading"==s?(n.show(),l&&(o=l)):"toast"==s?(J.anim(t,"scaleIn"),i=setTimeout(c,3e3)):(J.anim(t,"slideDownIn"),i=setTimeout(c,3e3))},l=function(){t.on("tap","#tag_close_toast",function(){c(),o()})};return s(),{show:r,hide:c}}(),Jingle.Transition=function(t){var n={slide:[["slideRightOut","slideRightIn"],["slideLeftOut","slideLeftIn"]],scale:[["scaleOut","none"],["none","scaleIn"]]},i=function(n,i,a){"none"==a[0]?(n.removeClass("active").addClass("activing"),i.addClass("active"),t.anim(i,a[1],function(){e(n,i)})):"none"==a[1]?(i.addClass("activing"),t.anim(n,a[0],function(){e(n,i)})):(n.removeClass("active").addClass("activing"),i.addClass("active"),t.anim(n,a[0]),t.anim(i,a[1],function(){e(n,i)}))},e=function(t,n){t.removeClass("activing active"),n.removeClass("activing").addClass("active"),t.trigger("hide"),n.trigger("show"),t.find("article.active").trigger("hide"),n.find("article.active").trigger("show")},a=function(e,a,o){e=$(e),a=$(a);var s=o?e.attr("data-transition"):a.attr("data-transition");s=s||t.settings.transitionType;var c=o?n[s][0]:n[s][1];i(e,a,c)};return{run:a}}(Jingle),Jingle.Popup=function(){var t,n,i,e={top:{top:0,left:0,right:0},"top-second":{top:"44px",left:0,right:0},center:{top:"30%",left:"10%",right:"10%","border-radius":"5px"},bottom:{bottom:0,left:0,right:0},"bottom-second":{bottom:"51px",left:0,right:0}},a={top:["slideDownIn","slideUpOut"],bottom:["slideUpIn","slideDownOut"],"default":["scaleIn","scaleOut"]},o=function(){$("body").append('<div id="jingle_popup"></div><div id="jingle_popup_mask"></div>'),n=$("#jingle_popup_mask"),t=$("#jingle_popup"),r()},s=function(o,s,c){var r=$.type(s);if(n.show(),t.attr("style",""),"object"==r)t.css(s);else{if("string"!=r)return console.error("错误的参数！"),void 0;t.css(e[s])}c&&t.append('<div id="tag_close_popup" data-target="closePopup" class="icon cancel-circle"></div>'),t.html(o).show(),J.Element.init(t),i=s.indexOf("top")>-1?a.top:s.indexOf("bottom")>-1?a.bottom:a["default"],J.anim(t,i[0]),t.trigger("open"),J.hasPopupOpen=!0},c=function(e){n.hide(),J.anim(t,i[1],function(){t.hide(),J.hasPopupOpen=!1,t.trigger("close"),e&&e()})},r=function(){n.on("tap",c),t.on("tap",'[data-target="closePopup"]',function(){c()})};o();var l=function(t){var n='<div class="title">'+t+'</div><div id="popup_btn_container"><button data-target="closePopup" data-icon="checkmark">OK</button></div>';s(n,"center",!1)},u=function(t,n,i){var e='<div class="title">'+t+'</div><div id="popup_btn_container"><button data-icon="checkmark">确定</button><button class="cancel" data-icon="close">取消</button></div>';s(e,"center",!0),$('#popup_btn_container [data-icon="checkmark"]').tap(function(){c(n)}),$('#popup_btn_container [data-icon="close"]').tap(function(){c(i)})};return{show:s,close:c,alert:l,confirm:u}}(),Jingle.Menu=function(t){var n={MENU:"body>aside",SECTION_CONTAINER:"#section-container"},i=function(){$(n.MENU).animate({translateX:"0%"},t.settings.transitionTime,"linear",function(){t.isMenuOpen=!0}),$(n.SECTION_CONTAINER).animate({translateX:"264px"},t.settings.transitionTime)},e=function(){$(n.MENU).animate({translateX:"-100%"},t.settings.transitionTime,"linear",function(){t.isMenuOpen=!1}),$(n.SECTION_CONTAINER).animate({translateX:0},t.settings.transitionTime)};return{show:i,hide:e}}(Jingle),function(){function t(t,n){var i,e,a,o,s,c,r=!1,l=0,u=300,d=$(t),p=function(){d.css("overflow","hidden"),e=d.children().first(),a=e.children(),o=a.length,s=d.offset().width,e.css("width",o*s),a.css({width:s,display:"table-cell",verticalAlign:"top"}),n||f(),g(0,0)},f=function(){if(i=d.find(".dots"),i.length>0)i.show();else{for(var t=30*o+20+2,n='<div class="dots"><ul>',e=0;o>e;e++)n+='<li index="'+e+'"><a href="#"></a></li>';n+="</ul></div>",d.append(n),i=d.find(".dots"),i.children().css("width",t+"px"),i.find("li").on("tap",function(){var t=$(this).attr("index");g(parseInt(t),u)})}},g=function(t,n){n=n||u,e.animate({translateX:-(t*s)+"px"},n),l=t,i&&$(i.find("li").get(l)).addClass("active").siblings().removeClass("active")},v=function(){e.on("touchstart",h,!1),e.on("touchmove",m,!1),e.on("touchend",w,!1),$(window).on("resize",p)},h=function(t){var n=t.touches[0];start={pageX:n.pageX,pageY:n.pageY,time:Number(new Date)},isScrolling=void 0,c=0,e[0].style.webkitTransitionDuration=0,r=!0,t.stopPropagation()},m=function(t){if(r){var n=t.touches[0];if(c=n.pageX-start.pageX,"undefined"==typeof isScrolling&&(isScrolling=!!(isScrolling||Math.abs(c)<Math.abs(n.pageY-start.pageY))),!isScrolling){t.preventDefault();var i=!l&&c>0||l==o-1&&0>c?Math.abs(c)/s+1:1;c/=i;var a=c-l*s;e[0].style.webkitTransform="translateX("+a+"px)",t.stopPropagation()}}},w=function(t){var n=250>Number(new Date)-start.time&&Math.abs(c)>20||Math.abs(c)>s/3,i=!l&&c>0||l==o-1&&0>c;isScrolling||g(l+(n&&!i?0>c?1:-1:0),u),r=!1,t.stopPropagation()};p(),v(),this.refresh=function(){e.attr("style",""),p()},this.prev=function(){l&&g(l-1,u)},this.next=function(){o-1>l&&g(l+1,u)},this.index=function(t){g(t)}}J.Slider=t}();