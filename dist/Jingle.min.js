var Jingle=J={settings:{transitionType:"slide",transitionTime:400,transitionTimingFunc:"ease",sectionPath:"html/"},mode:window.innerWidth<800?"phone":"tablet",hasTouch:"ontouchstart"in window,hasLaunched:!1,launchCompleted:!1,isMenuOpen:!1,hasPopupOpen:!1,isWebApp:"http:"==location.protocol,launch:function(a){$.extend(this.settings,a),this.Router.init(),this.Element.init(),$("body").delegate("article","show",function(){$(this).data("scroll")&&J.Scroll(this.id)})},anim:function(a,b){for(var c,d,e,f=arguments.length,g=2;f>g;g++){var h=arguments[g],i=$.type(h);"number"==i?c=h:"string"==i?d=h:"function"==i?e=h:null}$(a).animate(b,c||J.settings.transitionTime,d||J.settings.transitionTimingFunc,e)},showMask:function(a,b){"function"==$.type(a)&&(b=a,a=null),a=a||"Loading...",this.Toast.show("loading",a,b)},hideMask:function(){this.Toast.hide()},showToast:function(a,b){b=b||"toast",this.Toast.show(b,a)},hideToast:function(){this.Toast.hide()},alert:function(a,b){this.Popup.alert(a,b)},confirm:function(a,b,c,d){this.Popup.confirm(a,b,c,d)},popup:function(a,b,c){this.Popup.show(a,b,c)},closePopup:function(){this.Popup.close()},popover:function(a,b,c){this.Popup.popover(a,b,c)},tmpl:function(a,b,c){this.Template.render(a,b,c)}};Jingle.Element=function(){var a={icon:"[data-icon]",scroll:'[data-scroll="true"]',toggle:".toggle",range:"[data-rangeinput]",progress:"[data-progress]",count:"[data-count]"},b=function(b){var i=$(b||"body");0!=i.length&&($.map($(a.icon,i),c),$.map($(a.toggle,i),e),$.map($(a.range,i),f),$.map($(a.progress,i),g),$.map($(a.count,i),h),$.map($(a.scroll,i),d))},c=function(a){$(a).prepend('<i class="icon '+$(a).data("icon")+'"></i>')},d=function(a){J.Scroll(a)},e=function(a){var b=$(a),c=b.attr("name");c&&b.append('<input style="display: none;" name="'+c+'" value="'+b.hasClass("active")+'"/>');var d=b.find("input");b.tap(function(){var a;b.hasClass("active")?(b.removeClass("active"),a=!1):(b.addClass("active"),a=!0),d.val(a),b.trigger("toggle")})},f=function(a){var b,c=$(a),d=$('input[type="range"]',a),e=c.data("rangeinput"),f=$('<input type="text" name="test" value="'+d.val()+'"/>');b="left"==e?f.prependTo(c):f.appendTo(c);var g=parseInt(d.attr("max"),10),h=parseInt(d.attr("min"),10);d.change(function(){b.val(d.val())}),b.on("input",function(){var a=parseInt(b.val(),10);a=a>g?g:h>a?h:a,d.val(a),b.val(a)})},g=function(a){var b=$(a),c=parseFloat(b.data("progress")),d=b.data("title")||"",e=$('<div class="bar"></div>');c+="%",e.appendTo(b).width(c).text(d+c),"100%"==c&&e.css("border-radius","10px")},h=function(a){var b=$(a),c=parseInt(b.data("count")),d=b.data("orient"),e="left"==d?"left":"",f='<span class="count '+e+'">'+c+"</span>";b.append(f),0==c&&$(".count",a).hide()};return{init:b}}(),Jingle.Page=function(a){var b=function(a){return 0==a.indexOf("#")?a.substr(1):a},c=function(c){$.ajax({url:a.settings.sectionPath+b(c)+".html",timeout:5e3,async:!1,success:function(a){$("#section-container").append(a)}})};return{load:c}}(Jingle),Jingle.Router=function(){var a="a[data-target]",b=[],c=function(){$(window).on("popstate",d),$(document).on("tap","a",function(a){a.preventDefault()}),$(document).on("click","a",function(a){a.preventDefault()}),$(document).on("tap",a,e);var b=$("#section-container section.active").trigger("in").attr("id");i("#"+b)},d=function(a){if(a.state&&a.state.hash){var c=a.state.hash;c===b[1]&&g()}},e=function(a){a.preventDefault();var b=$(this),c=b.attr("data-target"),d=b.attr("href");switch(c){case"section":f(d);break;case"article":j(d,b);break;case"menu":k();break;case"back":g()}},f=function(a){if(J.isMenuOpen&&J.Menu.hide(),b[0]!==a){var c=$(b[0]);i(a),0===$(a).length&&(J.Page.load(a),J.Element.init(a)),h(c,a)}},g=function(){h(b.shift(),b[0],!0),window.history.replaceState({hash:b[0]},"",b[0])},h=function(a,b,c){J.Transition.run(a,b,c)},i=function(a){b.unshift(a),window.history.pushState({hash:a},"",a)},j=function(a,b){var c=$(a);if(!c.hasClass("active")){b.addClass("active").siblings(".active").removeClass("active");var d=c.addClass("active").siblings(".active").removeClass("active");J.anim(c,"scaleIn",300,function(){c.trigger("show"),d.trigger("hide")})}},k=function(){J.isMenuOpen?J.Menu.hide():J.Menu.show()};return{init:c,turnTo:f,back:g}}(),function(){var a={},b=1;J.Scroll=function(c,d){var e;"string"==$.type(c)?e=c:(e=$(c).attr("id"),e||(e="scroll-"+b++,$(c).attr("id",e)));var f;return a[e]?(f=a[e],f.refresh()):(f=new IScroll("#"+e,d),a[e]=f),f}}(),Jingle.Service=function(){function a(a,b,c,d){var e=!$.isFunction(b);return{url:a,data:e?b:void 0,success:e?$.isFunction(c)?c:void 0:b,dataType:e?d||c:c}}var b="JINGLE_POST_DATA",c=function(a){"post"==a.type?d(a):e(a)},d=function(a){J.offline?(h(a.url,a.data),a.success("数据已存至本地")):$.ajax(a)},e=function(a){var b=a.url+JSON.stringify(a.data);if(J.offline){var c=f(b);c?a.success(c.data,c.createdTime):a.success(c)}else{var d=a.success;a.success=function(a){g(b,a),d(a)},$.ajax(a)}},f=function(a){return JSON.parse(localStorage.getItem(a))},g=function(a,b){var c={data:b,createdTime:new Date};localStorage.setItem(a,JSON.stringify(c))},h=function(a,c){var d=i();d||(d={}),d[a]={data:c,createdTime:new Date},localStorage.setItem(b,JSON.stringify(d))},i=function(a){var c=JSON.parse(localStorage.getItem(b));return a?c[a]:c},j=function(a){if(a){var c=i();delete c[a],localStorage.setItem(b,JSON.stringify(c))}else localStorage.removeItem(b)},k=function(a,b,c){var d=i(a).data;$.ajax({url:a,data:d,type:"post",success:function(){b(a)},error:function(){c(a)}})},l=function(a,b){var c=i();for(var d in c)k(d,a,b)},m=function(){return c(a.apply(null,arguments))},n=function(){var b=a.apply(null,arguments);return b.type="POST",c(b)},o=function(){var b=a.apply(null,arguments);return b.dataType="json",c(b)},p=function(){window.localStorage.clear()};return{ajax:c,get:m,post:n,getJSON:o,getUnPostData:i,removeUnPostData:j,syncPostData:k,syncAllPostData:l,clear:p}}(),Jingle.Template=function(){var a=function(a,b,c){var d='<div class="back-mask"><div class="icon '+c+'"></div><div>'+b+"</div></div>";$(a).html(d)},b=function(b){a(b,"没有找到相关数据","drawer")},c=function(b){a(b,"加载中...","cloud-download")},d=function(a,c,d){var e=$(a);"array"==$.type(d)&&0==d.length?b(e):(e.html(template(c,d)),J.Element.init(e))};return{render:d,background:a,loading:c,no_result:b}}(),Jingle.Toast=function(){var a,b,c,d={toast:'<a href="#">{value}</a>',success:'<i class="icon checkmark-circle"></i>{value}',error:'<i class="icon cancel-circle"></i>{value}',info:'<i class="icon info-2"></i>{value}',loading:'<i class="icon spinner"></i><p>{value}</p><div id="tag_close_toast" class="icon cancel-circle"></div>'},e="toast",f=function(){},g=function(){$("body").append('<div id="jingle_toast"></div><div id="jingle_toast_mask"></div>'),b=$("#jingle_toast_mask"),a=$("#jingle_toast"),j()},h=function(){"loading"==e?(a.hide(),b.hide()):"toast"==e?J.anim(a,"scaleOut",function(){a.hide()}):J.anim(a,"slideUpOut",function(){a.hide()})},i=function(g,i,j){b.hide(),c&&clearTimeout(c),e=g,a.attr("class",g).html(d[g].replace("{value}",i)).show(),"loading"==g?(b.show(),j&&(f=j)):"toast"==g?(J.anim(a,"scaleIn"),c=setTimeout(h,3e3)):(J.anim(a,"slideDownIn"),c=setTimeout(h,3e3))},j=function(){a.on("tap","#tag_close_toast",function(){h(),f()})};return g(),{show:i,hide:h}}(),Jingle.Transition=function(a){var b=!1,c={slide:[["slideRightOut","slideRightIn"],["slideLeftOut","slideLeftIn"]],scale:[["scaleOut","none"],["none","scaleIn"]]},d=function(b,c,d){"none"==d[0]?(b.removeClass("active").addClass("activing"),c.addClass("active"),a.anim(c,d[1],function(){e(b,c)})):"none"==d[1]?(c.addClass("activing"),a.anim(b,d[0],function(){e(b,c)})):(b.removeClass("active").addClass("activing"),c.addClass("active"),a.anim(b,d[0]),a.anim(c,d[1],function(){e(b,c)}))},e=function(a,c){a.removeClass("activing active"),c.removeClass("activing").addClass("active"),a.trigger("out",[b]),c.trigger("in",[b]),a.find("article.active").trigger("hide"),c.find("article.active").trigger("show")},f=function(e,f,g){b=g,e=$(e),f=$(f);var h=b?e.attr("data-transition"):f.attr("data-transition");h=h||a.settings.transitionType;var i=b?c[h][0]:c[h][1];d(e,f,i)};return{run:f}}(Jingle),Jingle.Popup=function(){var a,b,c,d={top:{top:0,left:0,right:0},"top-second":{top:"44px",left:0,right:0},center:{top:"50%",left:"10%",right:"10%","border-radius":"3px"},bottom:{bottom:0,left:0,right:0},"bottom-second":{bottom:"51px",left:0,right:0}},e={top:["slideDownIn","slideUpOut"],bottom:["slideUpIn","slideDownOut"],defaultAnim:["scaleIn","scaleOut"]},f=function(){$("body").append('<div id="jingle_popup"></div><div id="jingle_popup_mask"></div>'),b=$("#jingle_popup_mask"),a=$("#jingle_popup"),i()},g=function(f,g,h,i){var j=$.type(g);if(b.show(),a.attr({style:"","class":""}),"object"==j)a.css(g),c=e.defaultAnim;else{if("string"!=j)return console.error("错误的参数！"),void 0;a.css(d[g]);var k=g.indexOf("top")>-1?"top":g.indexOf("bottom")>-1?"bottom":"defaultAnim";c=e[k]}i&&(a.addClass("arrow "+i),a.css("padding","8px"),("top"==i||"bottom"==i)&&(c=e[i])),h&&a.append('<div id="tag_close_popup" data-target="closePopup" class="icon cancel-circle"></div>'),a.html(f).show(),J.Element.init(a),J.anim(a,c[0]),a.trigger("open"),J.hasPopupOpen=!0},h=function(d){b.hide(),J.anim(a,c[1],function(){a.hide(),J.hasPopupOpen=!1,a.trigger("close"),d&&d()})},i=function(){b.on("tap",function(){h()}),a.on("tap",'[data-target="closePopup"]',function(){h()})};f();var j=function(a,b){var c='<div class="popup-title">'+a+'</div><div class="popup-content">'+b+'</div><div id="popup_btn_container"><a data-target="closePopup" data-icon="checkmark">OK</a></div>';g(c,"center",!1)},k=function(a,b,c,d){var e='<div class="popup-title">'+a+'</div><div class="popup-content">'+b+'</div><div id="popup_btn_container"><a data-icon="checkmark">确定</a><a class="cancel" data-icon="close">取消</a></div>';g(e,"center",!0),$('#popup_btn_container [data-icon="checkmark"]').tap(function(){h(c)}),$('#popup_btn_container [data-icon="close"]').tap(function(){h(d)})},l=function(a,b,c){g(a,b,!1,c)};return{show:g,close:h,alert:j,confirm:k,popover:l}}(),Jingle.Menu=function(a){var b={MENU:"body>aside",SECTION_CONTAINER:"#section-container"},c=function(){$(b.MENU).animate({translateX:"0%"},a.settings.transitionTime,"linear",function(){a.isMenuOpen=!0}),$(b.SECTION_CONTAINER).animate({translateX:"264px"},a.settings.transitionTime)},d=function(){$(b.MENU).animate({translateX:"-100%"},a.settings.transitionTime,"linear",function(){a.isMenuOpen=!1}),$(b.SECTION_CONTAINER).animate({translateX:0},a.settings.transitionTime)};return{show:c,hide:d}}(Jingle),function(){function a(a,b){var c,d,e,f,g,h,i,j=!1,k=0,l=300,m=function(){},n=function(){return!0};$.isPlainObject(a)?(c=$(a.selector),b=a.noDots,n=a.onBeforeSlide||n,m=a.onAfterSlide||m):c=$(a);var o=function(){c.css("overflow","hidden"),e=c.children().first(),f=e.children(),g=f.length,h=c.offset().width,e.css("width",g*h),f.css({width:h,"float":"left"}),b||p(),q(0,0)},p=function(){if(d=c.find(".dots"),d.length>0)d.show();else{for(var a=30*g+20+2,b='<div class="dots"><ul>',e=0;g>e;e++)b+='<li index="'+e+'"><a href="#"></a></li>';b+="</ul></div>",c.append(b),d=c.find(".dots"),d.children().css("width",a+"px"),d.find("li").on("tap",function(){var a=$(this).attr("index");q(parseInt(a),l)})}},q=function(a,b){b=b||l,e.animate({translateX:-(a*h)+"px"},b),k=a,d&&$(d.find("li").get(k)).addClass("active").siblings().removeClass("active"),m(k)},r=function(){e.on("touchstart",s,!1),e.on("touchmove",t,!1),e.on("touchend",u,!1)},s=function(a){var b=a.touches[0];start={pageX:b.pageX,pageY:b.pageY,time:Number(new Date)},isScrolling=void 0,i=0,e[0].style.webkitTransitionDuration=0,j=!0},t=function(a){if(j){var b=a.touches[0];if(i=b.pageX-start.pageX,"undefined"==typeof isScrolling&&(isScrolling=!!(isScrolling||Math.abs(i)<Math.abs(b.pageY-start.pageY))),!isScrolling){a.preventDefault();var c=!k&&i>0||k==g-1&&0>i;if(c)return;var d=i-k*h;e[0].style.webkitTransform="translateX("+d+"px)"}}},u=function(){var a=Number(new Date)-start.time<250&&Math.abs(i)>20||Math.abs(i)>h/3,b=!k&&i>0||k==g-1&&0>i;isScrolling||(n(k,i)?q(k+(a&&!b?0>i?1:-1:0),l):q(k)),j=!1};o(),r(),this.refresh=function(){e.attr("style",""),o()},this.prev=function(){k&&q(k-1,l)},this.next=function(){g-1>k&&q(k+1,l)},this.index=function(a){q(a)}}J.Slider=a}();